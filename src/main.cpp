
#include "Algorithm/algorithm.hpp"
#include "Core/core.hpp"
#include "IO/io.hpp"
#include "orionglobal.hpp"

error_t
main (int argc, char **argv)
{
    if (argc < 2)
    {
        ERROR << "Use : " << argv [0] << " filename.mesh" << ENDLINE;
        return EXIT_FAILURE;
    }

    std::cout << COLOR_YELLOW << std::string (50, '-') << ENDLINE;
    std::cout << COLOR_YELLOW << REVERSE << " Welcome in Orion2D !" << ENDLINE;
    std::cout << COLOR_YELLOW << std::string (50, '-') << ENDLINE;

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // INPUT
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    std::string filename = argv [1];

    Mesh input;
    Read (&input, filename);
    PrintStatistics (&input, "input");

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // TRIANGULATION
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    Mesh output;
    DelaunayTriangulation (&input, &output);
    BuildEdges (&output);
    PrintStatistics (&output, "output");

    MakeHistogram (&output);

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // Force  Boundaries
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    ForceBoundaries (&input, &output);

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // OUTPUT
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    size_t pos = filename.find (".mesh");
    if (pos != std::string::npos)
        filename.erase (pos, 5);

    Write (&output, filename + "_orion.mesh");
    WriteBB (&output, filename + "_orion.bb");


    return EXIT_SUCCESS;
}
